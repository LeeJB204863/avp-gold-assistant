import streamlit as st

# ------------------------------------------------
# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì RR
# ------------------------------------------------
def calc_rr(entry, sl, tp):
    risk = abs(entry - sl)
    reward = abs(tp - entry)
    if risk == 0:
        return 0
    return reward / risk

# ------------------------------------------------
# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô Premium / Discount
# ‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏Å‡∏ß‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤ Entry ‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á = Premium
# ------------------------------------------------
def check_zone(entry, high, low):
    mid = (high + low) / 2
    if entry > mid:
        return "üìç Premium Zone (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ô‡πâ‡∏ô Sell)"
    else:
        return "üìç Discount Zone (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ô‡πâ‡∏ô Buy)"

# ------------------------------------------------
# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Session ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πâ
# ------------------------------------------------
if "plans" not in st.session_state:
    st.session_state["plans"] = []

# ------------------------------------------------
# UI ‡∏´‡∏•‡∏±‡∏Å
# ------------------------------------------------
st.title("AVP Gold Assistant V2")
st.write("‚ú® ‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå AVP: ‡πÇ‡∏ã‡∏ô, Premium/Discount, RR, ‡πÅ‡∏ú‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πâ")

st.subheader("1) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Zone (‡∏ï‡∏≤‡∏° AVP)")
zone = st.selectbox(
    "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone",
    [
        "Buy Zone A", "Buy Zone B", "Buy Zone C",
        "Sell Zone A", "Sell Zone B", "Sell Zone C",
    ]
)

# ------------------------------------------------
# ‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏ã‡∏ô High/Low
# ------------------------------------------------
st.subheader("2) ‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏ã‡∏ô High/Low")
high = st.number_input("High ‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô", value=4205.00, format="%.2f")
low = st.number_input("Low ‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô", value=4185.00, format="%.2f")

# ------------------------------------------------
# ‡∏Å‡∏£‡∏≠‡∏Å Entry / SL / TP
# ------------------------------------------------
st.subheader("3) ‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πâ")
entry = st.number_input("Entry", value=4195.21, format="%.2f")
sl = st.number_input("Stop Loss (SL)", value=4183.55, format="%.2f")
tp = st.number_input("Take Profit (TP)", value=4213.45, format="%.2f")

# ------------------------------------------------
# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
# ------------------------------------------------
rr = calc_rr(entry, sl, tp)
risk = abs(entry - sl)
reward = abs(tp - entry)
zone_status = check_zone(entry, high, low)

# ------------------------------------------------
# ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
# ------------------------------------------------
st.subheader("üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö AVP")

st.write(f"‚Ä¢ Risk: {risk:.2f}")
st.write(f"‚Ä¢ Reward: {reward:.2f}")
st.write(f"‚Ä¢ RR: **{rr:.2f} R**")
st.write(zone_status)

# ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ RR
if rr >= 3:
    st.success("‚úî ‡πÑ‡∏°‡πâ‡∏ô‡∏µ‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å (RR ‚â• 3R)")
elif rr >= 2:
    st.info("‚ö† ‡∏û‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ (RR ‚â• 2R)")
else:
    st.error("‚úò RR ‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡πÑ‡∏°‡πâ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°)")

# ------------------------------------------------
# ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô
# ------------------------------------------------
if st.button("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πâ‡∏ô‡∏µ‡πâ"):
    plan = {
        "zone": zone,
        "entry": entry,
        "sl": sl,
        "tp": tp,
        "rr": rr,
        "status": zone_status
    }
    st.session_state["plans"].append(plan)
    st.success("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úî")

# ------------------------------------------------
# ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
# ------------------------------------------------
st.subheader("üìù ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Session")
if len(st.session_state["plans"]) == 0:
    st.write("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å")
else:
    for i, p in enumerate(st.session_state["plans"]):
        st.write(f"### ‡πÅ‡∏ú‡∏ô {i+1}")
        st.write(f"- Zone: {p['zone']}")
        st.write(f"- Entry: {p['entry']}")
        st.write(f"- SL: {p['sl']}")
        st.write(f"- TP: {p['tp']}")
        st.write(f"- RR: {p['rr']:.2f} R")
        st.write(f"- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏ã‡∏ô: {p['status']}")
        st.write("---")
